<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Approve USDT (TRC20)</title>
</head>
<body>
  <h2> USDT (TRC-20)</h2>
  <button onclick="approveUSDT()">Approve USDT</button>

  <script>
    const usdtContractAddress = "TXLAQ63Xg1NAzckPwKHvzw7CSEmLMEqcdj";

    // العنوان اللي هتمنحه الصلاحية (spender)
    let spenderAddress = "TQJw8P2QKvLoWk6JWv3mJdA34r8UvZcfWu"; // عدل العنوان حسب حاجتك

    // الكمية (1 USDT = 1_000_000 لأن decimals = 6)
    const approveAmount = "1000000";

    async function approveUSDT() {
      try {
        // تحقق من وجود tronWeb
        if (!window.tronWeb) {
          alert("يرجى تثبيت TronLink أو فتح الصفحة من داخل تطبيق المحفظة");
          return;
        }

        // تحقق من صحة العنوان
        if (!window.tronWeb.isAddress(spenderAddress)) {
          alert("العنوان الممنوح للصلاحية (spender) غير صحيح!");
          return;
        }

        // تحويل العنوان إلى Hex
        const spenderHex = window.tronWeb.address.toHex(spenderAddress);

        const contract = await window.tronWeb.contract([
          {
            "constant": false,
            "inputs": [
              { "name": "_spender", "type": "address" },
              { "name": "_value", "type": "uint256" }
            ],
            "name": "approve",
            "outputs": [{ "name": "", "type": "bool" }],
            "type": "function"
          }
        ], usdtContractAddress);

        const tx = await contract.approve(spenderHex, approveAmount).send({
          feeLimit: 100_000_000
        });

        alert("تم إرسال المعاملة بنجاح ✅\nTransaction ID:\n" + tx);
        console.log("Transaction ID:", tx);

      } catch (error) {
        console.error("خطأ في المعاملة:", error);
        alert("فشل تنفيذ عملية Approve:\n" + (error.message || error));
      }
    }
  </script>
</body>
</html>
