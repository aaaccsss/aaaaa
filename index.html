<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ربط محفظة TRON بـ WalletConnect</title>
<script src="https://cdn.jsdelivr.net/npm/@walletconnect/client@1.7.9/dist/umd/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@walletconnect/qrcode-modal@1.7.2/dist/umd/index.min.js"></script>
</head>
<body>

<button id="connectWalletBtn">ربط المحفظة</button>

<script>
  const WalletConnect = window.WalletConnect.default;
  const QRCodeModal = window.WalletConnectQRCodeModal.default;

  // إنشاء كائن WalletConnect جديد (لجلسة جديدة)
  const connector = new WalletConnect({
    bridge: "https://bridge.walletconnect.org", // جسر الاتصال
    qrcodeModal: QRCodeModal
  });

  async function connectWallet() {
    if (!connector.connected) {
      // إنشاء جلسة جديدة
      await connector.createSession();
    }

    // عرض رابط deep link للموبايل (URI)
    const uri = connector.uri;
    console.log("URI:", uri);

    // على الموبايل: توجه المحفظة تلقائي
    // Deep link مخصص لـ Trust Wallet أو TronLink (معظم المحافظ تدعم WalletConnect)
    // هذه الصيغة تطلب فتح تطبيق المحفظة تلقائيًا مع URI الجلسة
    const deepLink = https://link.trustwallet.com/wc?uri=${encodeURIComponent(uri)};

    // فتح رابط الـ deep link
    window.location.href = deepLink;
  }

  // الزرار يربط المحفظة
  document.getElementById("connectWalletBtn").addEventListener("click", connectWallet);

  // التعامل مع حدث الاتصال
  connector.on("connect", (error, payload) => {
    if (error) {
      throw error;
    }
    console.log("تم الاتصال بالمحفظة!");

    // هنا يمكنك الحصول على عنوان المحفظة من payload
    const accounts = payload.params[0].accounts;
    console.log("عنوان المحفظة:", accounts[0]);
    // تقدر تبني هنا طلبات approve بعد الربط
  });

  connector.on("disconnect", (error, payload) => {
    if (error) {
      throw error;
    }
    console.log("تم قطع الاتصال بالمحفظة");
  });
</script>

</body>
</html>
